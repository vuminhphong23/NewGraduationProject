<!-- fragments/user/header.html -->
<div class="header" th:fragment="header">
    <div class="header-logo">
        <i class="fas fa-graduation-cap"></i>
        <span>Forumi<span class="logo-orange">kaa</span></span>
    </div>
    <div class="header-search">
        <div class="smart-search-container">
            <div class="search-input-wrapper">
                <i class="fa fa-search search-icon"></i>
                <input type="text" id="smartSearchInput" placeholder="Tìm kiếm trên Forumikaa..." autocomplete="off">
                <button class="search-clear-btn" id="searchClearBtn" style="display: none;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Smart Search Dropdown -->
            <div class="smart-search-dropdown" id="smartSearchDropdown">
                <!-- Search Categories -->
                <div class="search-categories" id="searchCategories">
                    <div class="category-item active" data-category="all">
                        <i class="fas fa-globe-asia"></i>
                        <span>Tất cả</span>
                    </div>
                    <div class="category-item" data-category="posts">
                        <i class="fas fa-newspaper"></i>
                        <span>Bài viết</span>
                    </div>
                    <div class="category-item" data-category="users">
                        <i class="fas fa-users"></i>
                        <span>Người dùng</span>
                    </div>
                    <div class="category-item" data-category="groups">
                        <i class="fas fa-layer-group"></i>
                        <span>Nhóm</span>
                    </div>
                    <div class="category-item" data-category="events">
                        <i class="fas fa-calendar"></i>
                        <span>Sự kiện</span>
                    </div>
                </div>
                
                <!-- Search Results -->
                <div class="search-results" id="searchResults">
                    <!-- Recent Searches -->
                    <div class="search-section" id="recentSearches">
                        <div class="section-header">
                            <h6><i class="fas fa-clock"></i> Tìm kiếm gần đây</h6>
                            <button class="clear-recent-btn" id="clearRecentBtn">Xóa tất cả</button>
                        </div>
                        <div class="recent-searches-list" id="recentSearchesList">
                            <!-- Recent searches will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Trending Searches -->
                    <div class="search-section" id="trendingSearches">
                        <div class="section-header">
                            <h6><i class="fas fa-fire"></i> Xu hướng tìm kiếm</h6>
                        </div>
                        <div class="trending-searches-list" id="trendingSearchesList">
                            <!-- Trending searches will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Live Search Results -->
                    <div class="search-section" id="liveSearchResults" style="display: none;">
                        <div class="section-header">
                            <h6><i class="fas fa-search"></i> Kết quả tìm kiếm</h6>
                        </div>
                        <div class="live-results-list" id="liveResultsList">
                            <!-- Live search results will be populated here -->
                        </div>
                    </div>
                    
                    <!-- No Results -->
                    <div class="no-results" id="noResults" style="display: none;">
                        <div class="no-results-content">
                            <i class="fas fa-search"></i>
                            <h6>Không tìm thấy kết quả</h6>
                            <p>Thử tìm kiếm với từ khóa khác</p>
                        </div>
                    </div>
                </div>
                
                <!-- Search Footer -->
                <div class="search-footer">
                    <div class="search-shortcuts">
                        <span class="shortcut"><kbd>↑</kbd><kbd>↓</kbd> Điều hướng</span>
                        <span class="shortcut"><kbd>Enter</kbd> Chọn</span>
                        <span class="shortcut"><kbd>Esc</kbd> Đóng</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="header-menu" data-user-id="${#authentication.principal.id}">
        <a th:href="@{/}" class="menu-item" data-page="home"><i class="fa-solid fa-newspaper"></i><span class="menu-text">Bảng tin</span></a>
        <a th:href="@{/recommendations}" class="menu-item" data-page="recommendations"><i class="fa-solid fa-magic"></i><span class="menu-text">Gợi ý thông minh</span></a>
        <a th:href="@{/chat}" class="menu-item" data-page="chat"><i class="fa-solid fa-comments"></i><span class="menu-text">Tin nhắn</span></a>
        
        <!-- Notification Bell -->
        <div class="notification-dropdown position-relative">
            <a href="#" data-bs-toggle="dropdown" aria-expanded="false" class="notification-bell">
                <i class="fa-solid fa-bell"></i>
                <span class="menu-text">Thông báo</span>
                <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
            </a>
            <div class="dropdown-menu dropdown-menu-end notification-menu" style="width: 350px; max-height: 400px; overflow-y: auto;">
                <div class="dropdown-header d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">Thông báo</h6>
                    <div>
                        <button class="btn btn-sm btn-link text-decoration-none" id="markAllRead">Đánh dấu tất cả đã đọc</button>
                    </div>
                </div>
                <div class="dropdown-divider"></div>
                <div id="notificationList">
                    <div class="text-center py-3 text-muted">
                        <i class="fa fa-bell-slash fa-2x mb-2"></i>
                        <div>Không có thông báo nào</div>
                    </div>
                </div>
            </div>
        </div>
        
        <a th:href="@{/profile/{username}(username =${#authentication.name})}" class="menu-item" data-page="profile"><i class="fa-solid fa-user"></i><span class="menu-text">Tài khoản</span></a>
        <div class="dropdown">
            <a href="#" data-bs-toggle="dropdown" aria-expanded="false"><i class="fa-solid fa-gear"></i><span class="menu-text">Cài đặt</span></a>
            <ul class="dropdown-menu dropdown-menu-end">
                <li>
                    <form th:action="@{/logout}" method="post" style="margin:0;">
                        <button type="submit" class="dropdown-item">Đăng xuất</button>
                    </form>
                </li>
            </ul>
        </div>
    </div>
</div>

<script>
// Simple active menu detection
document.addEventListener('DOMContentLoaded', function() {
    const currentPath = window.location.pathname;
    const menuItems = document.querySelectorAll('.menu-item');
    
    console.log('Current path:', currentPath);
    console.log('Menu items found:', menuItems.length);
    
    menuItems.forEach(item => {
        const page = item.getAttribute('data-page');
        const href = item.getAttribute('href');
        
        console.log('Checking page:', page, 'href:', href);
        
        // Check if current path matches
        if (page === 'home' && currentPath === '/') {
            console.log('Adding active to home');
            item.classList.add('active');
        } else if (page !== 'home' && currentPath.includes('/' + page)) {
            console.log('Adding active to:', page);
            item.classList.add('active');
        }
        
        // Remove test code - no longer force active class
    });
});
</script>
